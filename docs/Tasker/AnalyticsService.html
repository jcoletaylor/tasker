<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Tasker::AnalyticsService
  
    &mdash; Documentation by YARD 0.9.37
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Tasker::AnalyticsService";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (A)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Tasker.html" title="Tasker (module)">Tasker</a></span></span>
     &raquo; 
    <span class="title">AnalyticsService</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Tasker::AnalyticsService
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Tasker::AnalyticsService</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/services/tasker/analytics_service.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Service class for analytics calculations and data aggregation</p>

<p>This service encapsulates the complex analytics logic that was previously in the analytics controller, providing a clean separation of concerns. It handles performance metrics, bottleneck analysis, and data aggregation using both SQL functions and ActiveRecord scopes.</p>


  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="AnalyticsService/BottleneckAnalytics.html" title="Tasker::AnalyticsService::BottleneckAnalytics (class)">BottleneckAnalytics</a></span>, <span class='object_link'><a href="AnalyticsService/PerformanceAnalytics.html" title="Tasker::AnalyticsService::PerformanceAnalytics (class)">PerformanceAnalytics</a></span>
    
  
</p>







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#analyze_dependency_bottlenecks-class_method" title="analyze_dependency_bottlenecks (class method)">.<strong>analyze_dependency_bottlenecks</strong>(scope_params, since_time)  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Analyze dependency bottlenecks using model scopes and SQL functions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#analyze_error_patterns-class_method" title="analyze_error_patterns (class method)">.<strong>analyze_error_patterns</strong>(scope_params, since_time)  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Analyze error patterns using model scopes.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#build_scoped_query-class_method" title="build_scoped_query (class method)">.<strong>build_scoped_query</strong>(scope_params, since_time)  &#x21d2; ActiveRecord::Relation </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Build scoped query using ActiveRecord scopes.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#calculate_bottleneck_analytics-class_method" title="calculate_bottleneck_analytics (class method)">.<strong>calculate_bottleneck_analytics</strong>(scope_params, period_hours)  &#x21d2; BottleneckAnalytics </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Calculate bottleneck analytics for specified scope and period using SQL functions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#calculate_performance_analytics-class_method" title="calculate_performance_analytics (class method)">.<strong>calculate_performance_analytics</strong>  &#x21d2; PerformanceAnalytics </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Calculate comprehensive performance analytics using SQL functions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#calculate_performance_distribution-class_method" title="calculate_performance_distribution (class method)">.<strong>calculate_performance_distribution</strong>(scope_params, since_time)  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Calculate performance distribution using model scopes.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#calculate_retry_success_rate-class_method" title="calculate_retry_success_rate (class method)">.<strong>calculate_retry_success_rate</strong>(scoped_query)  &#x21d2; Float </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Calculate retry success rate using model scopes.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#calculate_scope_summary-class_method" title="calculate_scope_summary (class method)">.<strong>calculate_scope_summary</strong>(scope_params, period_hours)  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Calculate scope summary using SQL functions and scopes.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#calculate_telemetry_insights-class_method" title="calculate_telemetry_insights (class method)">.<strong>calculate_telemetry_insights</strong>  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Calculate telemetry insights from trace and log backends.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#default_dependency_bottlenecks-class_method" title="default_dependency_bottlenecks (class method)">.<strong>default_dependency_bottlenecks</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#default_error_pattern-class_method" title="default_error_pattern (class method)">.<strong>default_error_pattern</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Default fallback methods for error conditions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#default_performance_distribution-class_method" title="default_performance_distribution (class method)">.<strong>default_performance_distribution</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fetch_slowest_steps-class_method" title="fetch_slowest_steps (class method)">.<strong>fetch_slowest_steps</strong>(scope_params, since_time)  &#x21d2; Array </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Fetch slowest steps using SQL function with fallback.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fetch_slowest_tasks-class_method" title="fetch_slowest_tasks (class method)">.<strong>fetch_slowest_tasks</strong>(scope_params, since_time)  &#x21d2; Array </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Fetch slowest tasks using SQL function with fallback.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_most_blocked_step_names-class_method" title="find_most_blocked_step_names (class method)">.<strong>find_most_blocked_step_names</strong>(task_ids)  &#x21d2; Array </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Find most blocked step names using SQL function for step readiness.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#generate_recommendations-class_method" title="generate_recommendations (class method)">.<strong>generate_recommendations</strong>(slowest_tasks, slowest_steps)  &#x21d2; Array </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Generate recommendations based on function data.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="analyze_dependency_bottlenecks-class_method">
  
    .<strong>analyze_dependency_bottlenecks</strong>(scope_params, since_time)  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Analyze dependency bottlenecks using model scopes and SQL functions</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>scope_params</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Scope parameters</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>since_time</span>
      
      
        <span class='type'>(<tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Analysis start time</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Dependency bottleneck analysis</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/tasker/analytics_service.rb', line 238</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_analyze_dependency_bottlenecks'>analyze_dependency_bottlenecks</span><span class='lparen'>(</span><span class='id identifier rubyid_scope_params'>scope_params</span><span class='comma'>,</span> <span class='id identifier rubyid_since_time'>since_time</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_scoped_query'>scoped_query</span> <span class='op'>=</span> <span class='id identifier rubyid_build_scoped_query'>build_scoped_query</span><span class='lparen'>(</span><span class='id identifier rubyid_scope_params'>scope_params</span><span class='comma'>,</span> <span class='id identifier rubyid_since_time'>since_time</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_task_ids'>task_ids</span> <span class='op'>=</span> <span class='id identifier rubyid_scoped_query'>scoped_query</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:task_id</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_default_dependency_bottlenecks'>default_dependency_bottlenecks</span> <span class='kw'>if</span> <span class='id identifier rubyid_task_ids'>task_ids</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

  <span class='comment'># Use existing scopes where possible
</span>  <span class='id identifier rubyid_pending_steps'>pending_steps</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="WorkflowStep.html" title="Tasker::WorkflowStep (class)">WorkflowStep</a></span></span><span class='period'>.</span><span class='id identifier rubyid_joins'>joins</span><span class='lparen'>(</span><span class='symbol'>:named_step</span><span class='rparen'>)</span>
                              <span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>task_id:</span> <span class='id identifier rubyid_task_ids'>task_ids</span><span class='rparen'>)</span>
                              <span class='period'>.</span><span class='id identifier rubyid_by_current_state'>by_current_state</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pending</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_blocking_count'>blocking_count</span> <span class='op'>=</span> <span class='id identifier rubyid_pending_steps'>pending_steps</span><span class='period'>.</span><span class='id identifier rubyid_joins'>joins</span><span class='lparen'>(</span><span class='symbol'>:incoming_edges</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span>
  <span class='id identifier rubyid_avg_wait'>avg_wait</span> <span class='op'>=</span> <span class='id identifier rubyid_pending_steps'>pending_steps</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>tasker_workflow_steps:</span> <span class='lbrace'>{</span> <span class='label'>created_at:</span> <span class='op'>...</span><span class='int'>5</span><span class='period'>.</span><span class='id identifier rubyid_minutes'>minutes</span><span class='period'>.</span><span class='id identifier rubyid_ago'>ago</span> <span class='rbrace'>}</span><span class='rparen'>)</span>
                          <span class='period'>.</span><span class='id identifier rubyid_average'>average</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>EXTRACT(EPOCH FROM (NOW() - tasker_workflow_steps.created_at))</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='lbrace'>{</span>
    <span class='label'>blocking_dependencies:</span> <span class='id identifier rubyid_blocking_count'>blocking_count</span><span class='comma'>,</span>
    <span class='label'>avg_wait_time:</span> <span class='id identifier rubyid_avg_wait'>avg_wait</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_f'>to_f</span><span class='op'>&amp;.</span><span class='id identifier rubyid_round'>round</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='float'>0.0</span><span class='comma'>,</span>
    <span class='label'>most_blocked_steps:</span> <span class='id identifier rubyid_find_most_blocked_step_names'>find_most_blocked_step_names</span><span class='lparen'>(</span><span class='id identifier rubyid_task_ids'>task_ids</span><span class='rparen'>)</span>
  <span class='rbrace'>}</span>
<span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error in analyze_dependency_bottlenecks: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_default_dependency_bottlenecks'>default_dependency_bottlenecks</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="analyze_error_patterns-class_method">
  
    .<strong>analyze_error_patterns</strong>(scope_params, since_time)  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Analyze error patterns using model scopes</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>scope_params</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Scope parameters</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>since_time</span>
      
      
        <span class='type'>(<tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Analysis start time</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Error pattern analysis</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/tasker/analytics_service.rb', line 213</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_analyze_error_patterns'>analyze_error_patterns</span><span class='lparen'>(</span><span class='id identifier rubyid_scope_params'>scope_params</span><span class='comma'>,</span> <span class='id identifier rubyid_since_time'>since_time</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_scoped_query'>scoped_query</span> <span class='op'>=</span> <span class='id identifier rubyid_build_scoped_query'>build_scoped_query</span><span class='lparen'>(</span><span class='id identifier rubyid_scope_params'>scope_params</span><span class='comma'>,</span> <span class='id identifier rubyid_since_time'>since_time</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_total_tasks'>total_tasks</span> <span class='op'>=</span> <span class='id identifier rubyid_scoped_query'>scoped_query</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_default_error_pattern'>default_error_pattern</span> <span class='kw'>if</span> <span class='id identifier rubyid_total_tasks'>total_tasks</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span>

  <span class='id identifier rubyid_failed_tasks'>failed_tasks</span> <span class='op'>=</span> <span class='id identifier rubyid_scoped_query'>scoped_query</span><span class='period'>.</span><span class='id identifier rubyid_failed_since'>failed_since</span><span class='lparen'>(</span><span class='id identifier rubyid_since_time'>since_time</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span>
  <span class='id identifier rubyid_error_rate'>error_rate</span> <span class='op'>=</span> <span class='id identifier rubyid_total_tasks'>total_tasks</span><span class='period'>.</span><span class='id identifier rubyid_positive?'>positive?</span> <span class='op'>?</span> <span class='lparen'>(</span><span class='id identifier rubyid_failed_tasks'>failed_tasks</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='op'>/</span> <span class='id identifier rubyid_total_tasks'>total_tasks</span> <span class='op'>*</span> <span class='int'>100</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='float'>0.0</span>

  <span class='lbrace'>{</span>
    <span class='label'>total_errors:</span> <span class='id identifier rubyid_failed_tasks'>failed_tasks</span><span class='comma'>,</span>
    <span class='label'>recent_error_rate:</span> <span class='id identifier rubyid_error_rate'>error_rate</span><span class='comma'>,</span>
    <span class='label'>common_error_types:</span> <span class='qwords_beg'>%w[</span><span class='tstring_content'>timeout</span><span class='words_sep'> </span><span class='tstring_content'>validation</span><span class='words_sep'> </span><span class='tstring_content'>network</span><span class='tstring_end'>]</span></span><span class='comma'>,</span> <span class='comment'># Static for now
</span>    <span class='label'>retry_success_rate:</span> <span class='id identifier rubyid_calculate_retry_success_rate'>calculate_retry_success_rate</span><span class='lparen'>(</span><span class='id identifier rubyid_scoped_query'>scoped_query</span><span class='rparen'>)</span>
  <span class='rbrace'>}</span>
<span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error in analyze_error_patterns: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_default_error_pattern'>default_error_pattern</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="build_scoped_query-class_method">
  
    .<strong>build_scoped_query</strong>(scope_params, since_time)  &#x21d2; <tt>ActiveRecord::Relation</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Build scoped query using ActiveRecord scopes</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>scope_params</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Scope parameters</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>since_time</span>
      
      
        <span class='type'>(<tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Time filter</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::Relation</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Filtered query</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


328
329
330
331
332
333
334</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/tasker/analytics_service.rb', line 328</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_build_scoped_query'>build_scoped_query</span><span class='lparen'>(</span><span class='id identifier rubyid_scope_params'>scope_params</span><span class='comma'>,</span> <span class='id identifier rubyid_since_time'>since_time</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_query'>query</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Task.html" title="Tasker::Task (class)">Task</a></span></span><span class='period'>.</span><span class='id identifier rubyid_created_since'><span class='object_link'><a href="Task.html#created_since-class_method" title="Tasker::Task.created_since (method)">created_since</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_since_time'>since_time</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_query'>query</span> <span class='op'>=</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_in_namespace'>in_namespace</span><span class='lparen'>(</span><span class='id identifier rubyid_scope_params'>scope_params</span><span class='lbracket'>[</span><span class='symbol'>:namespace</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_scope_params'>scope_params</span><span class='lbracket'>[</span><span class='symbol'>:namespace</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_query'>query</span> <span class='op'>=</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_with_task_name'>with_task_name</span><span class='lparen'>(</span><span class='id identifier rubyid_scope_params'>scope_params</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_scope_params'>scope_params</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_query'>query</span> <span class='op'>=</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_with_version'>with_version</span><span class='lparen'>(</span><span class='id identifier rubyid_scope_params'>scope_params</span><span class='lbracket'>[</span><span class='symbol'>:version</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_scope_params'>scope_params</span><span class='lbracket'>[</span><span class='symbol'>:version</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_query'>query</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="calculate_bottleneck_analytics-class_method">
  
    .<strong>calculate_bottleneck_analytics</strong>(scope_params, period_hours)  &#x21d2; <tt><span class='object_link'><a href="AnalyticsService/BottleneckAnalytics.html" title="Tasker::AnalyticsService::BottleneckAnalytics (class)">BottleneckAnalytics</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Calculate bottleneck analytics for specified scope and period using SQL functions</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>scope_params</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Scope parameters (namespace, name, version)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>period_hours</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Analysis period in hours</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="AnalyticsService/BottleneckAnalytics.html" title="Tasker::AnalyticsService::BottleneckAnalytics (class)">BottleneckAnalytics</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Bottleneck analysis data</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/tasker/analytics_service.rb', line 109</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_calculate_bottleneck_analytics'>calculate_bottleneck_analytics</span><span class='lparen'>(</span><span class='id identifier rubyid_scope_params'>scope_params</span><span class='comma'>,</span> <span class='id identifier rubyid_period_hours'>period_hours</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_since_time'>since_time</span> <span class='op'>=</span> <span class='id identifier rubyid_period_hours'>period_hours</span><span class='period'>.</span><span class='id identifier rubyid_hours'>hours</span><span class='period'>.</span><span class='id identifier rubyid_ago'>ago</span>

  <span class='comment'># Use SQL functions for efficient bottleneck analysis with fallbacks
</span>  <span class='id identifier rubyid_slowest_tasks'>slowest_tasks</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch_slowest_tasks'>fetch_slowest_tasks</span><span class='lparen'>(</span><span class='id identifier rubyid_scope_params'>scope_params</span><span class='comma'>,</span> <span class='id identifier rubyid_since_time'>since_time</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_slowest_steps'>slowest_steps</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch_slowest_steps'>fetch_slowest_steps</span><span class='lparen'>(</span><span class='id identifier rubyid_scope_params'>scope_params</span><span class='comma'>,</span> <span class='id identifier rubyid_since_time'>since_time</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_scope_summary'>scope_summary</span> <span class='op'>=</span> <span class='id identifier rubyid_calculate_scope_summary'>calculate_scope_summary</span><span class='lparen'>(</span><span class='id identifier rubyid_scope_params'>scope_params</span><span class='comma'>,</span> <span class='id identifier rubyid_period_hours'>period_hours</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_bottleneck_analysis'>bottleneck_analysis</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='label'>slowest_tasks:</span> <span class='id identifier rubyid_slowest_tasks'>slowest_tasks</span><span class='comma'>,</span>
    <span class='label'>slowest_steps:</span> <span class='id identifier rubyid_slowest_steps'>slowest_steps</span><span class='comma'>,</span>
    <span class='label'>error_patterns:</span> <span class='id identifier rubyid_analyze_error_patterns'>analyze_error_patterns</span><span class='lparen'>(</span><span class='id identifier rubyid_scope_params'>scope_params</span><span class='comma'>,</span> <span class='id identifier rubyid_since_time'>since_time</span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='label'>dependency_bottlenecks:</span> <span class='id identifier rubyid_analyze_dependency_bottlenecks'>analyze_dependency_bottlenecks</span><span class='lparen'>(</span><span class='id identifier rubyid_scope_params'>scope_params</span><span class='comma'>,</span> <span class='id identifier rubyid_since_time'>since_time</span><span class='rparen'>)</span>
  <span class='rbrace'>}</span>

  <span class='id identifier rubyid_performance_distribution'>performance_distribution</span> <span class='op'>=</span> <span class='id identifier rubyid_calculate_performance_distribution'>calculate_performance_distribution</span><span class='lparen'>(</span><span class='id identifier rubyid_scope_params'>scope_params</span><span class='comma'>,</span> <span class='id identifier rubyid_since_time'>since_time</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_recommendations'>recommendations</span> <span class='op'>=</span> <span class='id identifier rubyid_generate_recommendations'>generate_recommendations</span><span class='lparen'>(</span><span class='id identifier rubyid_slowest_tasks'>slowest_tasks</span><span class='comma'>,</span> <span class='id identifier rubyid_slowest_steps'>slowest_steps</span><span class='rparen'>)</span>

  <span class='const'><span class='object_link'><a href="AnalyticsService/BottleneckAnalytics.html" title="Tasker::AnalyticsService::BottleneckAnalytics (class)">BottleneckAnalytics</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="AnalyticsService/BottleneckAnalytics.html#initialize-instance_method" title="Tasker::AnalyticsService::BottleneckAnalytics#initialize (method)">new</a></span></span><span class='lparen'>(</span>
    <span class='label'>scope_summary:</span> <span class='id identifier rubyid_scope_summary'>scope_summary</span><span class='comma'>,</span>
    <span class='label'>bottleneck_analysis:</span> <span class='id identifier rubyid_bottleneck_analysis'>bottleneck_analysis</span><span class='comma'>,</span>
    <span class='label'>performance_distribution:</span> <span class='id identifier rubyid_performance_distribution'>performance_distribution</span><span class='comma'>,</span>
    <span class='label'>recommendations:</span> <span class='id identifier rubyid_recommendations'>recommendations</span><span class='comma'>,</span>
    <span class='label'>scope:</span> <span class='id identifier rubyid_scope_params'>scope_params</span><span class='comma'>,</span>
    <span class='label'>analysis_period_hours:</span> <span class='id identifier rubyid_period_hours'>period_hours</span>
  <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="calculate_performance_analytics-class_method">
  
    .<strong>calculate_performance_analytics</strong>  &#x21d2; <tt><span class='object_link'><a href="AnalyticsService/PerformanceAnalytics.html" title="Tasker::AnalyticsService::PerformanceAnalytics (class)">PerformanceAnalytics</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Calculate comprehensive performance analytics using SQL functions</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="AnalyticsService/PerformanceAnalytics.html" title="Tasker::AnalyticsService::PerformanceAnalytics (class)">PerformanceAnalytics</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Performance analytics data</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/tasker/analytics_service.rb', line 64</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_calculate_performance_analytics'>calculate_performance_analytics</span>
  <span class='id identifier rubyid_analysis_periods'>analysis_periods</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='label'>last_hour:</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_hour'>hour</span><span class='period'>.</span><span class='id identifier rubyid_ago'>ago</span><span class='comma'>,</span>
    <span class='label'>last_4_hours:</span> <span class='int'>4</span><span class='period'>.</span><span class='id identifier rubyid_hours'>hours</span><span class='period'>.</span><span class='id identifier rubyid_ago'>ago</span><span class='comma'>,</span>
    <span class='label'>last_24_hours:</span> <span class='int'>24</span><span class='period'>.</span><span class='id identifier rubyid_hours'>hours</span><span class='period'>.</span><span class='id identifier rubyid_ago'>ago</span>
  <span class='rbrace'>}</span>

  <span class='comment'># Use the analytics metrics SQL function for efficient data retrieval
</span>  <span class='id identifier rubyid_base_metrics'>base_metrics</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Tasker.html" title="Tasker (module)">Tasker</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Functions.html" title="Tasker::Functions (module)">Functions</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Functions/FunctionBasedAnalyticsMetrics.html" title="Tasker::Functions::FunctionBasedAnalyticsMetrics (class)">FunctionBasedAnalyticsMetrics</a></span></span><span class='period'>.</span><span class='id identifier rubyid_call'><span class='object_link'><a href="Functions/FunctionBasedAnalyticsMetrics.html#call-class_method" title="Tasker::Functions::FunctionBasedAnalyticsMetrics.call (method)">call</a></span></span>

  <span class='id identifier rubyid_system_overview'>system_overview</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='label'>active_tasks:</span> <span class='id identifier rubyid_base_metrics'>base_metrics</span><span class='period'>.</span><span class='id identifier rubyid_active_tasks_count'>active_tasks_count</span><span class='comma'>,</span>
    <span class='label'>total_namespaces:</span> <span class='id identifier rubyid_base_metrics'>base_metrics</span><span class='period'>.</span><span class='id identifier rubyid_total_namespaces_count'>total_namespaces_count</span><span class='comma'>,</span>
    <span class='label'>unique_task_types:</span> <span class='id identifier rubyid_base_metrics'>base_metrics</span><span class='period'>.</span><span class='id identifier rubyid_unique_task_types_count'>unique_task_types_count</span><span class='comma'>,</span>
    <span class='label'>system_health_score:</span> <span class='id identifier rubyid_base_metrics'>base_metrics</span><span class='period'>.</span><span class='id identifier rubyid_system_health_score'>system_health_score</span>
  <span class='rbrace'>}</span>

  <span class='id identifier rubyid_performance_trends'>performance_trends</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='comment'># Calculate trends for each time period using SQL functions
</span>  <span class='id identifier rubyid_analysis_periods'>analysis_periods</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_period_name'>period_name</span><span class='comma'>,</span> <span class='id identifier rubyid_since_time'>since_time</span><span class='op'>|</span>
    <span class='id identifier rubyid_period_metrics'>period_metrics</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Tasker.html" title="Tasker (module)">Tasker</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Functions.html" title="Tasker::Functions (module)">Functions</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Functions/FunctionBasedAnalyticsMetrics.html" title="Tasker::Functions::FunctionBasedAnalyticsMetrics (class)">FunctionBasedAnalyticsMetrics</a></span></span><span class='period'>.</span><span class='id identifier rubyid_call'><span class='object_link'><a href="Functions/FunctionBasedAnalyticsMetrics.html#call-class_method" title="Tasker::Functions::FunctionBasedAnalyticsMetrics.call (method)">call</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_since_time'>since_time</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_performance_trends'>performance_trends</span><span class='lbracket'>[</span><span class='id identifier rubyid_period_name'>period_name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lbrace'>{</span>
      <span class='label'>task_throughput:</span> <span class='id identifier rubyid_period_metrics'>period_metrics</span><span class='period'>.</span><span class='id identifier rubyid_task_throughput'>task_throughput</span><span class='comma'>,</span>
      <span class='label'>completion_rate:</span> <span class='id identifier rubyid_period_metrics'>period_metrics</span><span class='period'>.</span><span class='id identifier rubyid_completion_rate'>completion_rate</span><span class='comma'>,</span>
      <span class='label'>error_rate:</span> <span class='id identifier rubyid_period_metrics'>period_metrics</span><span class='period'>.</span><span class='id identifier rubyid_error_rate'>error_rate</span><span class='comma'>,</span>
      <span class='label'>avg_task_duration:</span> <span class='id identifier rubyid_period_metrics'>period_metrics</span><span class='period'>.</span><span class='id identifier rubyid_avg_task_duration'>avg_task_duration</span><span class='comma'>,</span>
      <span class='label'>avg_step_duration:</span> <span class='id identifier rubyid_period_metrics'>period_metrics</span><span class='period'>.</span><span class='id identifier rubyid_avg_step_duration'>avg_step_duration</span><span class='comma'>,</span>
      <span class='label'>step_throughput:</span> <span class='id identifier rubyid_period_metrics'>period_metrics</span><span class='period'>.</span><span class='id identifier rubyid_step_throughput'>step_throughput</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_telemetry_insights'>telemetry_insights</span> <span class='op'>=</span> <span class='id identifier rubyid_calculate_telemetry_insights'>calculate_telemetry_insights</span>

  <span class='const'><span class='object_link'><a href="AnalyticsService/PerformanceAnalytics.html" title="Tasker::AnalyticsService::PerformanceAnalytics (class)">PerformanceAnalytics</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="AnalyticsService/PerformanceAnalytics.html#initialize-instance_method" title="Tasker::AnalyticsService::PerformanceAnalytics#initialize (method)">new</a></span></span><span class='lparen'>(</span>
    <span class='label'>system_overview:</span> <span class='id identifier rubyid_system_overview'>system_overview</span><span class='comma'>,</span>
    <span class='label'>performance_trends:</span> <span class='id identifier rubyid_performance_trends'>performance_trends</span><span class='comma'>,</span>
    <span class='label'>telemetry_insights:</span> <span class='id identifier rubyid_telemetry_insights'>telemetry_insights</span>
  <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="calculate_performance_distribution-class_method">
  
    .<strong>calculate_performance_distribution</strong>(scope_params, since_time)  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Calculate performance distribution using model scopes</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>scope_params</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Scope parameters</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>since_time</span>
      
      
        <span class='type'>(<tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Analysis start time</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Performance distribution data</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/tasker/analytics_service.rb', line 267</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_calculate_performance_distribution'>calculate_performance_distribution</span><span class='lparen'>(</span><span class='id identifier rubyid_scope_params'>scope_params</span><span class='comma'>,</span> <span class='id identifier rubyid_since_time'>since_time</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_scoped_query'>scoped_query</span> <span class='op'>=</span> <span class='id identifier rubyid_build_scoped_query'>build_scoped_query</span><span class='lparen'>(</span><span class='id identifier rubyid_scope_params'>scope_params</span><span class='comma'>,</span> <span class='id identifier rubyid_since_time'>since_time</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_completed_tasks'>completed_tasks</span> <span class='op'>=</span> <span class='id identifier rubyid_scoped_query'>scoped_query</span><span class='period'>.</span><span class='id identifier rubyid_completed_since'>completed_since</span><span class='lparen'>(</span><span class='id identifier rubyid_since_time'>since_time</span><span class='rparen'>)</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_default_performance_distribution'>default_performance_distribution</span> <span class='kw'>if</span> <span class='id identifier rubyid_completed_tasks'>completed_tasks</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

  <span class='comment'># Simple distribution calculation using model scopes
</span>  <span class='id identifier rubyid_total_completed'>total_completed</span> <span class='op'>=</span> <span class='id identifier rubyid_completed_tasks'>completed_tasks</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span>

  <span class='lbrace'>{</span>
    <span class='label'>percentiles:</span> <span class='lbrace'>{</span> <span class='label'>p50:</span> <span class='float'>15.0</span><span class='comma'>,</span> <span class='label'>p95:</span> <span class='float'>45.0</span><span class='comma'>,</span> <span class='label'>p99:</span> <span class='float'>75.0</span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='comment'># Simplified for now
</span>    <span class='label'>distribution_buckets:</span> <span class='lbracket'>[</span>
      <span class='lbrace'>{</span> <span class='label'>range:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0-10s</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>count:</span> <span class='lparen'>(</span><span class='id identifier rubyid_total_completed'>total_completed</span> <span class='op'>*</span> <span class='float'>0.6</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span> <span class='rbrace'>}</span><span class='comma'>,</span>
      <span class='lbrace'>{</span> <span class='label'>range:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>10-30s</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>count:</span> <span class='lparen'>(</span><span class='id identifier rubyid_total_completed'>total_completed</span> <span class='op'>*</span> <span class='float'>0.3</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span> <span class='rbrace'>}</span><span class='comma'>,</span>
      <span class='lbrace'>{</span> <span class='label'>range:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>30s+</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>count:</span> <span class='lparen'>(</span><span class='id identifier rubyid_total_completed'>total_completed</span> <span class='op'>*</span> <span class='float'>0.1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span> <span class='rbrace'>}</span>
    <span class='rbracket'>]</span>
  <span class='rbrace'>}</span>
<span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error in calculate_performance_distribution: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_default_performance_distribution'>default_performance_distribution</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="calculate_retry_success_rate-class_method">
  
    .<strong>calculate_retry_success_rate</strong>(scoped_query)  &#x21d2; <tt>Float</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Calculate retry success rate using model scopes</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>scoped_query</span>
      
      
        <span class='type'>(<tt>ActiveRecord::Relation</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Scoped task query</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Retry success rate percentage</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


340
341
342
343
344
345
346
347
348
349
350
351
352
353</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/tasker/analytics_service.rb', line 340</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_calculate_retry_success_rate'>calculate_retry_success_rate</span><span class='lparen'>(</span><span class='id identifier rubyid_scoped_query'>scoped_query</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_task_ids'>task_ids</span> <span class='op'>=</span> <span class='id identifier rubyid_scoped_query'>scoped_query</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:task_id</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='float'>0.0</span> <span class='kw'>if</span> <span class='id identifier rubyid_task_ids'>task_ids</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

  <span class='id identifier rubyid_retry_steps'>retry_steps</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="WorkflowStep.html" title="Tasker::WorkflowStep (class)">WorkflowStep</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>task_id:</span> <span class='id identifier rubyid_task_ids'>task_ids</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>attempts &gt; 1</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_total_retries'>total_retries</span> <span class='op'>=</span> <span class='id identifier rubyid_retry_steps'>retry_steps</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span>
  <span class='kw'>return</span> <span class='float'>0.0</span> <span class='kw'>if</span> <span class='id identifier rubyid_total_retries'>total_retries</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span>

  <span class='id identifier rubyid_successful_retries'>successful_retries</span> <span class='op'>=</span> <span class='id identifier rubyid_retry_steps'>retry_steps</span><span class='period'>.</span><span class='id identifier rubyid_by_current_state'>by_current_state</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>complete</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span>
  <span class='lparen'>(</span><span class='id identifier rubyid_successful_retries'>successful_retries</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='op'>/</span> <span class='id identifier rubyid_total_retries'>total_retries</span> <span class='op'>*</span> <span class='int'>100</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>
<span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error calculating retry success rate: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='float'>0.0</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="calculate_scope_summary-class_method">
  
    .<strong>calculate_scope_summary</strong>(scope_params, period_hours)  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Calculate scope summary using SQL functions and scopes</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>scope_params</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Scope parameters</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>period_hours</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Analysis period</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Scope summary data</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


194
195
196
197
198
199
200
201
202
203
204
205
206</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/tasker/analytics_service.rb', line 194</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_calculate_scope_summary'>calculate_scope_summary</span><span class='lparen'>(</span><span class='id identifier rubyid_scope_params'>scope_params</span><span class='comma'>,</span> <span class='id identifier rubyid_period_hours'>period_hours</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_since_time'>since_time</span> <span class='op'>=</span> <span class='id identifier rubyid_period_hours'>period_hours</span><span class='period'>.</span><span class='id identifier rubyid_hours'>hours</span><span class='period'>.</span><span class='id identifier rubyid_ago'>ago</span>
  <span class='id identifier rubyid_scoped_query'>scoped_query</span> <span class='op'>=</span> <span class='id identifier rubyid_build_scoped_query'>build_scoped_query</span><span class='lparen'>(</span><span class='id identifier rubyid_scope_params'>scope_params</span><span class='comma'>,</span> <span class='id identifier rubyid_since_time'>since_time</span><span class='rparen'>)</span>

  <span class='lbrace'>{</span>
    <span class='label'>total_tasks:</span> <span class='id identifier rubyid_scoped_query'>scoped_query</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='comma'>,</span>
    <span class='label'>unique_task_types:</span> <span class='id identifier rubyid_scoped_query'>scoped_query</span><span class='period'>.</span><span class='id identifier rubyid_joins'>joins</span><span class='lparen'>(</span><span class='symbol'>:named_task</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_distinct'>distinct</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tasker_named_tasks.name</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='label'>time_span_hours:</span> <span class='id identifier rubyid_period_hours'>period_hours</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span>
  <span class='rbrace'>}</span>
<span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error in calculate_scope_summary: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='lbrace'>{</span> <span class='label'>total_tasks:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>unique_task_types:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='label'>time_span_hours:</span> <span class='id identifier rubyid_period_hours'>period_hours</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="calculate_telemetry_insights-class_method">
  
    .<strong>calculate_telemetry_insights</strong>  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Calculate telemetry insights from trace and log backends</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Telemetry insights</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


140
141
142
143
144
145
146
147
148
149</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/tasker/analytics_service.rb', line 140</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_calculate_telemetry_insights'>calculate_telemetry_insights</span>
  <span class='id identifier rubyid_trace_backend'>trace_backend</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Tasker.html" title="Tasker (module)">Tasker</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Telemetry.html" title="Tasker::Telemetry (module)">Telemetry</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Telemetry/TraceBackend.html" title="Tasker::Telemetry::TraceBackend (class)">TraceBackend</a></span></span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span>
  <span class='id identifier rubyid_log_backend'>log_backend</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Tasker.html" title="Tasker (module)">Tasker</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Telemetry.html" title="Tasker::Telemetry (module)">Telemetry</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Telemetry/LogBackend.html" title="Tasker::Telemetry::LogBackend (class)">LogBackend</a></span></span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span>

  <span class='lbrace'>{</span>
    <span class='label'>trace_stats:</span> <span class='id identifier rubyid_trace_backend'>trace_backend</span><span class='period'>.</span><span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span>
    <span class='label'>log_stats:</span> <span class='id identifier rubyid_log_backend'>log_backend</span><span class='period'>.</span><span class='id identifier rubyid_stats'>stats</span><span class='comma'>,</span>
    <span class='label'>event_router_stats:</span> <span class='const'><span class='object_link'><a href="../Tasker.html" title="Tasker (module)">Tasker</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Telemetry.html" title="Tasker::Telemetry (module)">Telemetry</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Telemetry/EventRouter.html" title="Tasker::Telemetry::EventRouter (class)">EventRouter</a></span></span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span><span class='period'>.</span><span class='id identifier rubyid_routing_stats'>routing_stats</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="default_dependency_bottlenecks-class_method">
  
    .<strong>default_dependency_bottlenecks</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


390
391
392
393
394
395
396</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/tasker/analytics_service.rb', line 390</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_default_dependency_bottlenecks'>default_dependency_bottlenecks</span>
  <span class='lbrace'>{</span>
    <span class='label'>blocking_dependencies:</span> <span class='int'>0</span><span class='comma'>,</span>
    <span class='label'>avg_wait_time:</span> <span class='float'>0.0</span><span class='comma'>,</span>
    <span class='label'>most_blocked_steps:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="default_error_pattern-class_method">
  
    .<strong>default_error_pattern</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Default fallback methods for error conditions</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


381
382
383
384
385
386
387
388</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/tasker/analytics_service.rb', line 381</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_default_error_pattern'>default_error_pattern</span>
  <span class='lbrace'>{</span>
    <span class='label'>total_errors:</span> <span class='int'>0</span><span class='comma'>,</span>
    <span class='label'>recent_error_rate:</span> <span class='float'>0.0</span><span class='comma'>,</span>
    <span class='label'>common_error_types:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span>
    <span class='label'>retry_success_rate:</span> <span class='float'>0.0</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="default_performance_distribution-class_method">
  
    .<strong>default_performance_distribution</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


398
399
400
401
402
403
404
405
406
407</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/tasker/analytics_service.rb', line 398</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_default_performance_distribution'>default_performance_distribution</span>
  <span class='lbrace'>{</span>
    <span class='label'>percentiles:</span> <span class='lbrace'>{</span> <span class='label'>p50:</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='label'>p95:</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='label'>p99:</span> <span class='float'>0.0</span> <span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='label'>distribution_buckets:</span> <span class='lbracket'>[</span>
      <span class='lbrace'>{</span> <span class='label'>range:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0-10s</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>count:</span> <span class='int'>0</span> <span class='rbrace'>}</span><span class='comma'>,</span>
      <span class='lbrace'>{</span> <span class='label'>range:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>10-30s</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>count:</span> <span class='int'>0</span> <span class='rbrace'>}</span><span class='comma'>,</span>
      <span class='lbrace'>{</span> <span class='label'>range:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>30s+</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>count:</span> <span class='int'>0</span> <span class='rbrace'>}</span>
    <span class='rbracket'>]</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fetch_slowest_steps-class_method">
  
    .<strong>fetch_slowest_steps</strong>(scope_params, since_time)  &#x21d2; <tt>Array</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Fetch slowest steps using SQL function with fallback</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>scope_params</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Scope parameters</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>since_time</span>
      
      
        <span class='type'>(<tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Analysis start time</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Array of slowest step data</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


175
176
177
178
179
180
181
182
183
184
185
186
187</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/tasker/analytics_service.rb', line 175</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_fetch_slowest_steps'>fetch_slowest_steps</span><span class='lparen'>(</span><span class='id identifier rubyid_scope_params'>scope_params</span><span class='comma'>,</span> <span class='id identifier rubyid_since_time'>since_time</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Tasker.html" title="Tasker (module)">Tasker</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Functions.html" title="Tasker::Functions (module)">Functions</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Functions/FunctionBasedSlowestSteps.html" title="Tasker::Functions::FunctionBasedSlowestSteps (class)">FunctionBasedSlowestSteps</a></span></span><span class='period'>.</span><span class='id identifier rubyid_call'><span class='object_link'><a href="Functions/FunctionBasedSlowestSteps.html#call-class_method" title="Tasker::Functions::FunctionBasedSlowestSteps.call (method)">call</a></span></span><span class='lparen'>(</span>
    <span class='label'>since_timestamp:</span> <span class='id identifier rubyid_since_time'>since_time</span><span class='comma'>,</span>
    <span class='label'>limit_count:</span> <span class='int'>10</span><span class='comma'>,</span>
    <span class='label'>namespace_filter:</span> <span class='id identifier rubyid_scope_params'>scope_params</span><span class='lbracket'>[</span><span class='symbol'>:namespace</span><span class='rbracket'>]</span><span class='comma'>,</span>
    <span class='label'>task_name_filter:</span> <span class='id identifier rubyid_scope_params'>scope_params</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='comma'>,</span>
    <span class='label'>version_filter:</span> <span class='id identifier rubyid_scope_params'>scope_params</span><span class='lbracket'>[</span><span class='symbol'>:version</span><span class='rbracket'>]</span>
  <span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_h</span><span class='rparen'>)</span>
<span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SQL function FunctionBasedSlowestSteps failed: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_content'>, using fallback</span><span class='tstring_end'>&quot;</span></span>
  <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fetch_slowest_tasks-class_method">
  
    .<strong>fetch_slowest_tasks</strong>(scope_params, since_time)  &#x21d2; <tt>Array</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Fetch slowest tasks using SQL function with fallback</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>scope_params</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Scope parameters</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>since_time</span>
      
      
        <span class='type'>(<tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Analysis start time</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Array of slowest task data</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


156
157
158
159
160
161
162
163
164
165
166
167
168</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/tasker/analytics_service.rb', line 156</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_fetch_slowest_tasks'>fetch_slowest_tasks</span><span class='lparen'>(</span><span class='id identifier rubyid_scope_params'>scope_params</span><span class='comma'>,</span> <span class='id identifier rubyid_since_time'>since_time</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Tasker.html" title="Tasker (module)">Tasker</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Functions.html" title="Tasker::Functions (module)">Functions</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Functions/FunctionBasedSlowestTasks.html" title="Tasker::Functions::FunctionBasedSlowestTasks (class)">FunctionBasedSlowestTasks</a></span></span><span class='period'>.</span><span class='id identifier rubyid_call'><span class='object_link'><a href="Functions/FunctionBasedSlowestTasks.html#call-class_method" title="Tasker::Functions::FunctionBasedSlowestTasks.call (method)">call</a></span></span><span class='lparen'>(</span>
    <span class='label'>since_timestamp:</span> <span class='id identifier rubyid_since_time'>since_time</span><span class='comma'>,</span>
    <span class='label'>limit_count:</span> <span class='int'>10</span><span class='comma'>,</span>
    <span class='label'>namespace_filter:</span> <span class='id identifier rubyid_scope_params'>scope_params</span><span class='lbracket'>[</span><span class='symbol'>:namespace</span><span class='rbracket'>]</span><span class='comma'>,</span>
    <span class='label'>task_name_filter:</span> <span class='id identifier rubyid_scope_params'>scope_params</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='comma'>,</span>
    <span class='label'>version_filter:</span> <span class='id identifier rubyid_scope_params'>scope_params</span><span class='lbracket'>[</span><span class='symbol'>:version</span><span class='rbracket'>]</span>
  <span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_h</span><span class='rparen'>)</span>
<span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SQL function FunctionBasedSlowestTasks failed: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_content'>, using fallback</span><span class='tstring_end'>&quot;</span></span>
  <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_most_blocked_step_names-class_method">
  
    .<strong>find_most_blocked_step_names</strong>(task_ids)  &#x21d2; <tt>Array</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Find most blocked step names using SQL function for step readiness</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>task_ids</span>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Array of task IDs to analyze</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Array of step names that are frequently blocked</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/tasker/analytics_service.rb', line 359</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_find_most_blocked_step_names'>find_most_blocked_step_names</span><span class='lparen'>(</span><span class='id identifier rubyid_task_ids'>task_ids</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_task_ids'>task_ids</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

  <span class='comment'># Use existing SQL function for step readiness analysis
</span>  <span class='id identifier rubyid_step_statuses'>step_statuses</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Tasker.html" title="Tasker (module)">Tasker</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Functions.html" title="Tasker::Functions (module)">Functions</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Functions/FunctionBasedStepReadinessStatus.html" title="Tasker::Functions::FunctionBasedStepReadinessStatus (class)">FunctionBasedStepReadinessStatus</a></span></span><span class='period'>.</span><span class='id identifier rubyid_for_tasks'><span class='object_link'><a href="Functions/FunctionBasedStepReadinessStatus.html#for_tasks-class_method" title="Tasker::Functions::FunctionBasedStepReadinessStatus.for_tasks (method)">for_tasks</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_task_ids'>task_ids</span><span class='rparen'>)</span>

  <span class='comment'># Find steps that are pending and have unsatisfied dependencies (blocked)
</span>  <span class='id identifier rubyid_blocked_steps'>blocked_steps</span> <span class='op'>=</span> <span class='id identifier rubyid_step_statuses'>step_statuses</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_step'>step</span><span class='op'>|</span>
    <span class='id identifier rubyid_step'>step</span><span class='period'>.</span><span class='id identifier rubyid_current_state'>current_state</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pending</span><span class='tstring_end'>&#39;</span></span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_step'>step</span><span class='period'>.</span><span class='id identifier rubyid_dependencies_satisfied'>dependencies_satisfied</span>
  <span class='kw'>end</span>

  <span class='comment'># Count by step name and return top 3
</span>  <span class='id identifier rubyid_step_name_counts'>step_name_counts</span> <span class='op'>=</span> <span class='id identifier rubyid_blocked_steps'>blocked_steps</span><span class='period'>.</span><span class='id identifier rubyid_group_by'>group_by</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:name</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_transform_values'>transform_values</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:count</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_most_blocked'>most_blocked</span> <span class='op'>=</span> <span class='id identifier rubyid_step_name_counts'>step_name_counts</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid__name'>_name</span><span class='comma'>,</span> <span class='id identifier rubyid_count'>count</span><span class='op'>|</span> <span class='op'>-</span><span class='id identifier rubyid_count'>count</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='lparen'>(</span><span class='int'>3</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:first</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_most_blocked'>most_blocked</span><span class='period'>.</span><span class='id identifier rubyid_presence'>presence</span> <span class='op'>||</span> <span class='qwords_beg'>%w[</span><span class='tstring_content'>data_validation</span><span class='words_sep'> </span><span class='tstring_content'>external_api_calls</span><span class='tstring_end'>]</span></span>
<span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SQL function FunctionBasedStepReadinessStatus failed: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_content'>, using fallback</span><span class='tstring_end'>&quot;</span></span>
  <span class='qwords_beg'>%w[</span><span class='tstring_content'>data_validation</span><span class='words_sep'> </span><span class='tstring_content'>external_api_calls</span><span class='tstring_end'>]</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="generate_recommendations-class_method">
  
    .<strong>generate_recommendations</strong>(slowest_tasks, slowest_steps)  &#x21d2; <tt>Array</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Generate recommendations based on function data</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>slowest_tasks</span>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Slowest tasks from SQL function</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>slowest_steps</span>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Slowest steps from SQL function</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Array of recommendation strings</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/services/tasker/analytics_service.rb', line 294</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_generate_recommendations'>generate_recommendations</span><span class='lparen'>(</span><span class='id identifier rubyid_slowest_tasks'>slowest_tasks</span><span class='comma'>,</span> <span class='id identifier rubyid_slowest_steps'>slowest_steps</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_recommendations'>recommendations</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='comment'># Analyze slowest tasks
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_slowest_tasks'>slowest_tasks</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_task'>task</span><span class='op'>|</span> <span class='id identifier rubyid_task'>task</span><span class='lbracket'>[</span><span class='symbol'>:duration_seconds</span><span class='rbracket'>]</span> <span class='op'>&gt;</span> <span class='int'>60</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_avg_duration'>avg_duration</span> <span class='op'>=</span> <span class='id identifier rubyid_slowest_tasks'>slowest_tasks</span><span class='period'>.</span><span class='id identifier rubyid_sum'>sum</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_task'>task</span><span class='op'>|</span> <span class='id identifier rubyid_task'>task</span><span class='lbracket'>[</span><span class='symbol'>:duration_seconds</span><span class='rbracket'>]</span> <span class='rbrace'>}</span> <span class='op'>/</span> <span class='id identifier rubyid_slowest_tasks'>slowest_tasks</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
    <span class='id identifier rubyid_recommendations'>recommendations</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Consider optimizing long-running tasks (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_avg_duration'>avg_duration</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>s average)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># Analyze step patterns
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_slowest_steps'>slowest_steps</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_step'>step</span><span class='op'>|</span> <span class='id identifier rubyid_step'>step</span><span class='lbracket'>[</span><span class='symbol'>:attempts</span><span class='rbracket'>]</span> <span class='op'>&gt;</span> <span class='int'>1</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_recommendations'>recommendations</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>High retry patterns detected. Review error handling and timeout configurations.</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># Default recommendations if none generated
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_recommendations'>recommendations</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_recommendations'>recommendations</span> <span class='op'>=</span> <span class='lbracket'>[</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Monitor task performance trends regularly</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Review timeout configurations for network operations</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Consider implementing caching for repeated operations</span><span class='tstring_end'>&#39;</span></span>
    <span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_recommendations'>recommendations</span><span class='period'>.</span><span class='id identifier rubyid_take'>take</span><span class='lparen'>(</span><span class='int'>5</span><span class='rparen'>)</span>
<span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error generating recommendations: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Monitor system performance regularly</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Fri Jul 11 17:34:49 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-3.2.4).
</div>

    </div>
  </body>
</html>